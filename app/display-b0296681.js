!function(){"use strict";angular.module("eventsApp",["sharedResources"])}(),function(){"use strict";angular.module("eventsApp",["sharedResources"]).filter("time",function(){return function(e){return!e||e.indexOf("T")<0||e.indexOf("-")<0?void 0:(e=e.split("T")[1].split("-")[0],moment(e,"HH:mm:ss").format("h:mm a"))}}).filter("timeRange",function(){return function(e){if(e){var t=e.start,n=e.end;if(!(t.indexOf("T")<0||t.indexOf("-")<0||n.indexOf("T")<0||n.indexOf("-")<0))return t=t.split("T")[1].split("-")[0],t=moment(t,"HH:mm:ss").format("h:mm"),n=n.split("T")[1].split("-")[0],n=moment(n,"HH:mm:ss").format("h:mma"),t+"-"+n}}}).filter("date",function(){return function(e){if(e){var t;if(e.indexOf("T")>-1){var n=e.split("T");t=moment(n[0],["MM/DD","YYYY-MM-DD"])}else t=moment(e,"YYYY-MM-DD");return t.format("MM/DD")}}}).filter("titleDate",function(){return function(e){if(e){var t;if(e.indexOf("T")>-1){var n=e.split("T");t=moment(n[0],["MM/DD","YYYY-MM-DD"])}else t=moment(e,"YYYY-MM-DD");return t.format("MMM D")}}}).filter("fullDate",function(){return function(e){if(e){var t;if(e.indexOf("T")>-1){var n=e.split("T");t=moment(n[0],["MM/DD","YYYY-MM-DD"])}else t=moment(e,["YYYY-MM-DD","MM-DD-YYYY"]);return t.format("MMMM D, YYYY")}}}).filter("arrayToString",function(){return function(e){return!e||!e instanceof Array?void 0:e.join(" ")}}).filter("recurrenceDays",function(){return function(e){return e&&0!==e.length?"("+e.join("/")+")":void 0}}).filter("fee",function(){return function(e){if(e){if([void 0,"","Free","free",0,"$0"].indexOf(e)>-1)return"Free";var t=e.replace(".00","");return-1===t.indexOf("$")&&(t="$"+t),t}}}).filter("arrayToIconClasses",function(){return function(e){if(e&&!(!e instanceof Array)){var t="icon-heattimer",n="icon-swimming1",r="icon-climbing";return-1===e.indexOf(t)&&e.indexOf("Fitness")>-1&&e.push(t),-1===e.indexOf(n)&&e.indexOf("Pool")>-1&&e.push(n),-1===e.indexOf(r)&&e.indexOf("Rock Wall")>-1&&e.push(r),e.join(" ")}}}).filter("minutesToTimeString",function(){return function(e){if(e){var t="",n=Math.floor(e/60);n>0&&(t+=n,t+=n>1?" hours":" hour");var r=e%60;return n>0&&r>0&&(t+=" & "),r>0&&(t+=r+" minutes"),t}}}).filter("preventDuplicateDeadlines",function(){return function(e){if(e){var t=[];return angular.forEach(e,function(e){var n=!0;angular.forEach(t,function(t){n&&t.title==e.title&&t.start==e.start&&(n=!1)}),n&&t.push(e)}),t}}}).filter("trusted",["$sce",function(e){return function(t){return t?e.trustAsHtml(t):void 0}}]).filter("excerpt",function(){return function(e,t){return e?e.length<t?e:e.substring(0,t)+"...":void 0}})}(),function(){"use strict";angular.module("eventsApp").controller("EventsCtrl",["$scope","appService","calendarService",function(e,t,n){var r=moment(),i=!0;e.events={list:[]},t.runOnLoad().then(function(t){e.staticEvents=t.settings.staticEvents;var a=[];angular.forEach(e.staticEvents,function(e){a.push(e.title)}),n.init(t),i&&n.getEvents().then(function(t){if(!r.isAfter(t.requestTime)){var n=[];e.events.list=t.events.filter(function(e){return n.indexOf(e.id)>-1||a.indexOf(e.title)>-1?!1:(n.push(e.id),!0)}).sort(function(e,t){return e.startMoment.isSame(t.startMoment)?0:e.startMoment.isAfter(t.startMoment)?1:-1}),e.$apply()}})}),e.$on("dontAutoFetchEvents",function(){i=!1})}])}(),function(){"use strict";angular.module("eventsApp").directive("blockView",["PLUGIN_ROOT",function(e){return{templateUrl:e+"/templates/display/block.html"}}])}(),function(){"use strict";angular.module("eventsApp").directive("detailsView",["PLUGIN_ROOT","appService","calendarService","dateService",function(e,t,n,r){return{templateUrl:e+"/templates/display/details.html",link:function(e){function i(t){n.getRecurrence(t).then(function(t){if(t){var n=t.split("BYDAY=").pop().split(",");if(e.recurrence=r.getDaysString(n),t.indexOf("UNTIL")>-1){var i="";angular.forEach(t.split(";"),function(e){e.indexOf("UNTIL")>-1&&(i=e)}),e.sessionEndsOn=moment(i,"YYYYMMDDTHHmmSSZ").format("MMMM D, YYYY")}}})}e.noEventFound=!1,e.$emit("dontAutoFetchEvents"),t.runOnLoad().then(function(t){n.init(t),n.getEvent().then(function(t){if(e.event=t,t.recurrence)e.recurrence=t.recurrence;else if(t.recurringEventId)i(t);else if(void 0!==t){var n=[t.startMoment.format("dd").toUpperCase()];e.recurrence=r.getDaysString(n)}else e.noEventFound=!0},function(){e.noEventFound=!0})})}}}])}(),function(){"use strict";angular.module("eventsApp").directive("listView",["PLUGIN_ROOT",function(e){return{templateUrl:e+"/templates/display/list.html"}}])}(),function(){"use strict";angular.module("eventsApp").service("calendarService",["$rootScope","$filter","googleApiService","dateService",function(e,t,n,r){function i(){var e=[];return angular.forEach(u.calendars,function(t){l.indexOf(t.name)>-1&&e.push(t.id)}),e}function a(e,t,i){return t||(t=moment().startOf("week").startOf("day")),i||(i=t.clone().add(2,"months")),t=r.getDateTimeString(t.format("MM/DD/YYYY h:mma")),i=r.getDateTimeString(i.format("MM/DD/YYYY h:mma")),n.getEvents(c,t,i)}var o,u,s,c,l=[];this.init=function(e){o=e,l=["ISS Events"],u=o.settings,angular.forEach(o.config.view,function(e){l.push(e.trim())}),s=o.config.categories,c=i()},this.getEvents=function(e,t){return a(s,e,t)},this.getEvent=function(){return n.getEvent(o.config.calendarId,o.config.eventId)},this.getRecurrence=function(e){return n.getRecurrenceForEvent(e)}}])}(),function(){"use strict";angular.module("sharedResources",[]).constant("PLUGIN_ROOT","/wp-content/plugins/iss_events_manager").constant("SEPARATOR","\n\n------------------------------\n").constant("AT_SIGN_REPLACEMENT","%%at%%").constant("FIELDS",{CATEGORIES:"Categories: ",DETAILS_URL:"Details URL: ",FEE:"Fee: ",RECTRAC_URL:"Registration URL: ",REGISTRATION_URL:"Registration URL: ",REGISTRATION_DEADLINE:"Registration deadline: ",DATE_DESCRIPTION:"Date description: "}).filter("unique",function(){return function(e,t){var n=[],r=[];return angular.forEach(e,function(e){var i=e;angular.forEach(t.split("."),function(e){i=i[e]}),-1===r.indexOf(i)&&(r.push(i),n.push(e))}),n}})}(),function(){"use strict";angular.module("sharedResources").controller("MainCtrl",["$scope","$timeout","appService",function(e,t,n){function r(){t(function(){void 0===gapi||void 0===gapi.client||void 0===gapi.client.setApiKey?r():n.appIsLoaded()},5)}var i;e.categories=[],e.loading=!0,e.init=function(t){i=angular.fromJson(t),e.loading=!1,e.categories=i.categories.all,e.view=i.view,e.calendarId=i.calendarId,e.eventId=i.eventId,e.detailsPage=i.detailsPage,e.settings=i.settings,n.init(i),r()}}])}(),function(){"use strict";angular.module("sharedResources").directive("loading",function(){return{template:'<div class="bsuEventSpinner"></loading>'}})}(),function(){"use strict";angular.module("sharedResources").service("appService",["$http","$q","googleApiService","PLUGIN_ROOT","AT_SIGN_REPLACEMENT",function(e,t,n,r,i){function a(){var t=[];angular.forEach(o.categories.all,function(e){t.push({name:e.name,parent:e.name}),angular.forEach(e.children,function(n){t.push({name:n,parent:e.name})})}),o.calendarId&&(o.calendarId=o.calendarId.replace(i,"@"));var a=o.categories.view,s=[];return void 0!==a&&a.length>0&&(s="all"===a?t:a.split(",")),e.get(r+"/config.json").then(function(e){return n.init(e.data),u={settings:e.data,config:{categories:t,view:s,defaultView:o.defaultView,calendarId:o.calendarId,eventId:o.eventId,detailsPage:o.detailsPage}},void 0!==o.icons&&(u.icons=o.icons),u})}var o,u,s=t.defer();this.init=function(e){o=e},this.runOnLoad=function(){return s.promise},this.appIsLoaded=function(){s.resolve(a())}}])}(),function(){"use strict";angular.module("sharedResources").service("dateService",function(){function e(e){return 10>e?"0"+e:e}this.getDateString=function(e,t,n){void 0===t&&(t="YYYY-MM-DD");var r=moment(e,["MM/DD/YYYY"]).format(t);return void 0!==n&&(r+="Z"),r},this.getDateTimeString=function(t,n){var r=moment().isDST()?"-06:00":"-07:00";return moment(e(t)+e(n),["MM/DD/YYYY h:mma"]).format("YYYY-MM-DDTHH:mm:ss"+r)},this.getDaysString=function(e){var t=[];return angular.forEach(e,function(e){switch(e){case"MO":t.push("M");break;case"TU":t.push("Tu");break;case"WE":t.push("W");break;case"TH":t.push("Th");break;case"FR":t.push("F");break;case"SA":t.push("Sa");break;case"SU":t.push("Su")}}),t.join("/")}})}(),function(){"use strict";angular.module("sharedResources").service("eventService",["AT_SIGN_REPLACEMENT",function(e){function t(e){return void 0!==e.start.date?e.start.date:e.start.dateTime}function n(e){return void 0!==e.end.date?e.end.date:e.end.dateTime}function r(t,n){var r=a.detailsPage;return r+=r.indexOf("?")>-1?"&":"?",r+="id="+t.id+"&cal="+n,r.replace("@",e)}function i(e,t,n,r,i){var a;if(t&&e.id){var o=n.format("YYYYMMDDTHHmmss"),u=r.format("YYYYMMDDTHHmmss");a="http://www.google.com/calendar/event?action=TEMPLATE&text="+e.summary+"&dates="+o+"/"+u+"&details="+i+"&location="+e.location+"&trp=false"}return a}var a;this.init=function(e){a=e},this.formatForDisplay=function(e,a){var o=e.description,u=t(e),s=n(e),c=moment(u,["YYYY-MM-DDTHH:mm:ssZ"]),l=moment(s,["YYYY-MM-DDTHH:mm:ssZ"]);return{id:e.id,calendarId:a,description:o,location:e.location,start:u,startMoment:c,end:s,duration:l.diff(c,"minutes"),allDay:c.isSame(l),summary:e.summary,title:e.summary,categories:null,url:r(e,a),googleCalUrl:i(e,a,c,l,o),recurrence:e.recurrence,recurringEventId:e.recurringEventId,registration:{url:null,deadline:null}}}}])}(),function(){"use strict";angular.module("sharedResources").service("googleApiService",["$q","eventService",function(e,t){var n="v3";this.init=function(e){gapi.client.setApiKey(e.apiKey),t.init(e)},this.getEvent=function(r,i){var a=e.defer();return r&&i?(gapi.client.load("calendar",n).then(function(){gapi.client.calendar.events.get({calendarId:r,eventId:i}).then(function(e){var n=t.formatForDisplay(e.result,r);a.resolve(n)},function(){a.reject("Error loading calendar event.")})}),a.promise):(a.reject("Calendar not found."),a.promise)},this.getEvents=function(r,i,a){var o=moment(),u=[],s=[];return gapi.client.load("calendar",n).then(function(){return angular.forEach(r,function(e){if(null!==e){var n=gapi.client.calendar.events.list({calendarId:e,singleEvents:!0,timeMin:i,timeMax:a}).then(function(n){angular.forEach(n.result.items,function(n){var r=t.formatForDisplay(n,e);s.push(r)})});u.push(n)}}),e.all(u).then(function(){return s=s.sort(function(e,t){return e.startMoment.isSame(t.startMoment)?0:e.startMoment.isAfter(t.startMoment)?1:-1}),{events:s,requestTime:o}})})},this.getRecurrenceForEvent=function(t,r){var i=e.defer();return void 0===t.recurrence&&void 0!==t.recurringEventId?gapi.client.load("calendar",n).then(function(){gapi.client.calendar.events.get({calendarId:t.calendarId,eventId:t.recurringEventId}).then(function(e){i.resolve(e.result.recurrence.shift())},function(){i.reject("Original recurring event not found.")})}):r(t.recurrence),i.promise}}])}();
//# sourceMappingURL=../app/maps/display-b0296681.js.map